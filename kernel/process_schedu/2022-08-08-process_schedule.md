# 进程调度

> 内核基本原理
>
> 调度、进程调度

## 什么是调度

* 调度：CPU 资源的管理器

* 内核进程调度：对 CPU **进行时间分割管理**的具体做法就叫做进程调度。

* 进程调度和线程调度：进程是资源分配的单位，线程是执行的单位。进程调度调度的就是线程，习惯叫做进程调度。

* 线程调度的两种方式：

    * 一种是直接调度线程，不考虑它们所属的进程，这种方式叫做直接调度或者一级调度；

    * 另一种是先调度进程，再在进程内部调度线程，这种方式叫做间接调度或者二级调度。**POSIX **规定，操作系统可以选择这两种方式中的任何一种都行。

* Linux选择的调度方式：

    ​		内核选择一级调度，为什么会这么选择呢？主要是为了提高进程的并发性，充分利用多 CPU 多核的优势。如果使用二级调度的话，看似每个进程之间都公平了，但是有些进程的计算量比较大，就**无法通过多开线程提高自己的性能**，这样对系统整体的性能是有害的，也不利用发挥计算机多 CPU 的优势。一级调度看似对有些进程不公平，但是计算量小的进程少开线程，计算量大的进程多开线程，相对还是很公平的。

## 为什么要调度

> 多任务执行

* 协作式多任务：当程序由于要等 IO 而阻塞时就会去调度执行其它的进程。但协作式多任务存在着很大的问题，就是每个进程运行的**时间片长短是不确定的**，而且是很偶然很随机的。如果一个进程它一直在做运算就是不进行IO操作，那么它就会一直霸占CPU。针对这个问题，当时想出的方法是道德解决方案。内核向进程提供系统调用sched_yield，它会使进程主动放弃CPU让其它进程来执行。

* 抢占式